<!DOCTYPE html>

<html>
<head>
	<title>Processee</title>

	<link rel="stylesheet" type="text/css" href="./style/style.css">
	<link rel="stylesheet" type="text/css" href="./style/codemirror.css">
	<link rel="stylesheet" type="text/css" href="./style/processee-light.css">

	<script type="text/javascript" src="./lib/jquery.min.js"></script>
	<script type="text/javascript" src="./lib/processing.min.js"></script>
	<script type="text/javascript" src="./lib/coffee-script.min.js"></script>
	<script type="text/javascript" src="./lib/codemirror.js"></script>
	<script type="text/javascript" src="./lib/mode-processee.js"></script>

	<script type="text/javascript" src="./js/main.js"></script>
	<script type="text/javascript" src="./js/processee.js"></script>
</head>

<body>
	<div class="editor">
	<textarea id="codemirror"></textarea>
	</div>
	<div class="output" id="output">
		<div class="webcam">
			<video id="webcam"></video>
			<div class="cheese" id="cheese"></div>
		</div>
		<canvas class="output" id="processing"></canvas>
	</div>
	<div class="buttons">
		<a class="button run" onclick="processee.run();">&rArr;</a>
		<a class="button" onclick="toggleAbout();">?</a>
	</div>
	<div class="internals">
		<canvas id="processee-internal-canvas"></canvas>
		<img id="processee-image-loader"></img>
		<div class="examples">
<div id="ex-overlay">
image = "usyd.jpg"
logo = "usyd-logo.png"

processee.setup ->
  @loadImage image
  @loadImage logo

processee.do ->
  @canvasSize = @sizeOf image
  @drawImage image
  @drawImage logo
</div>
<div id="ex-pixelate">
image = "landscape.jpg"
pixelated = "pixelated"

pixelSize = 5

processee.setup ->
  @loadImage image

processee.do ->
  @canvasSize = @sizeOf image
  @makeNewImage pixelated, image
  @forEachPixelOf pixelated, (pixel) ->
    pixel.x = pixel.x - (pixel.x % pixelSize)
    pixel.y = pixel.y - (pixel.y % pixelSize)
    return @getImagePixel pixelated, pixel
  @drawImage pixelated
</div>
<div id="ex-pixelatemask">
# Pixelate mask
# This effect pixelates an image a variable amount. At the 'focal point'
# there is no pixelation. Regions further from the focal point are more
# and more pixelated. The pixels get bigger the further you go.
# Inspired by PicMonkey's Focal Pixelate effect.
# Daniel Buckmaster, 2013

# Hold the image file name in a global variable.
image = "landscape.jpg"

# Constants related to the effect. Change these to change
# the way the effect is applied.
radius = 90
focalPoint = {
  x: 750
  y: 200
}
maxPixelSize = 10

# Asynchronously load the source image.
processee.setup ->
  @loadImage image

# Main function.
processee.do ->
  # Scale the canvas to the size of the image.
  @canvasSize = @sizeOf image
  # This helper calls a function on every pixel in the image, and puts the
  # return values into a new image map of the same dimensions. After all
  # pixels are processed, the old image data is replaced with the new.
  @forEachPixelOf image, (pixel) ->
    # First, calculate the distance (in pixels) to the focal point.
    dist = Math.sqrt(Math.pow(focalPoint.x - pixel.x, 2) + Math.pow(focalPoint.y - pixel.y, 2))
    # Scale it a bit and round down.
    dist = Math.floor(dist / radius)
    # In CoffeeScript, the result of the last statement in a function is
    # Returned. In this case we return the result of an if statement:
    if dist is 0
      # For pixels very close to the focus, return their unmodified value.
      pixel
    else
      # Calculate the pixel size we want at this radius.
      size = Math.min(maxPixelSize, dist)
      # Calculate the coordinates to read from by modding the coordinates
      # of the current pixel by the pixel size. This creates the pixelation
      # effect (see the '#pixelate' example).
      dx = pixel.x - (pixel.x % size)
      dy = pixel.y - (pixel.y % size)
      # Return the value of the pixel at the new coordinates.
      @getImagePixel image, dx, dy
  # Finally, draw the transformed image.
  @drawImage image
</div>
<div id="ex-webcam">
image = "webcam"
processee.photobooth ->
  @canvasSize = @sizeOf image
  @drawImage image
</div>
<div id="ex-image">
image = "monalisa.jpg"

processee.setup ->
  @loadImage image

processee.do ->
  @canvasSize = @sizeOf image
  @drawImage image
</div>
<div id="ex-flower">
# Add a setup step. In this one, we set the canvas size and background color.
# You can do these things from anywhere, really, but this is a sensible
# place to put them.
processee.setup ->
  @canvasSize = dim 300, 300
  @canvasBackground = gray 255

# This is an actual draw instruction. Processee will do this step once. You
# can define multiple 'do' steps in the same way.
processee.do ->
  # This does a specific function, but moves any output to the location given.
  @at {x: 150, y: 250}, stalk
  @at {x: 150, y: 100}, petals
  @at {x: 175, y: 210}, leaf
  @at {x: 125, y: 230}, leaf

# This function will draw the flower's stalk - just a big green rectangle.
stalk = ->
  # These lines set some properties of the drawing environment. It's like
  # saying 'dip my brush in green paint'!
  @fillColor = rgb 0, 255, 0
  @strokeColor = rgb 0, 255, 0
  # This call makes a rectangle shape appear at the point we're drawing at.
  @drawRect {
    width: 10
    height: 200
  }

leaf = ->
  @fillColor = rgb 0, 255, 0
  @strokeColor = rgb 0, 255, 0
  @drawEllipse {
    width: 40
    height: 20
  }

petals = ->
  # Setting transparency to greater than 0 makes all objects we draw inside
  # this function a bit see-through.
  @transparency = 0.2
  # This for loop performs its contents once for every item in the list (a
  # list is a bunch of values between [square brackets].
  for angle in [0, Math.PI/3, Math.PI/6]
    # This function rotates the canvas a bit before calling the petal function.
    @rotatedBy angle, petal

petal = ->
  @fillColor = rgb 255, 0, 0
  @strokeColor = rgb 255, 0, 0
  @drawSquare {
    size: 100
  }
</div>
<div id="ex-threshold">
image = "lenna.jpg"

processee.setup ->
  @loadImage image

processee.do ->
  @canvasSize = @sizeOf image
  @forEachPixelOf image, threshold
  @drawImage image

threshold = (pixel) ->
  if pixel.red + pixel.green + pixel.blue > 382
    gray 255
  else
    gray 0
</div>
<div id="ex-pixels">
processee.do ->
  @makeNewImage "img", { width: 255, height: 255 }
  @canvasSize = @sizeOf "img"
  @forEachPixelOf "img", chooseColor
  @drawImage "img"

chooseColor = (pixel) ->
  gray ((pixel.x + pixel.y) % 255)
</div>
<div id="ex-blur">
image = "lenna.jpg"

processee.setup ->
  @loadImage image

processee.do ->
  @canvasSize = @sizeOf image
  @forEachGridOf image, @convolveWith {
    matrix: [
      1, 1, 1,
      1, 1, 1,
      1, 1, 1,
    ]
    scale: 1/9
  }
  @drawImage image
</div>
<div id="ex-sharpen">
image = "lenna.jpg"

processee.setup ->
  @loadImage image

processee.do ->
  @canvasSize = @sizeOf image
  @forEachGridOf image, @convolveWith [
     0, -1,  0,
    -1,  5, -1,
     0, -1,  0,
  ]
  @drawImage image
</div>
<div id="ex-median">
image = "monalisa.jpg"

processee.setup ->
  @loadImage image

processee.do ->
  @canvasSize = @sizeOf image
  @forEachGridOf image, median
  @drawImage image

median = (pixels) ->
  reds = sort (p.red for p in pixels)
  greens = sort (p.green for p in pixels)
  blues = sort (p.blue for p in pixels)
  rgb reds[4], greens[4], blues[4]
</div>
		</div>
	</div>
	<div class="about">
		<div class="dialog">
			<h2>Demos</h2>
			<ul>
				<li><a href="#flower">Draw a simple flower. Inspired by Bret Victor</a></li>
				<li><a href="#image">Load and display an image file</a></li>
				<li><a href="#pixels">Create your own pixel array to work with</a></li>
				<li><a href="#threshold">A threshold filter</a></li>
				<li><a href="#sharpen">A sharpening filter using unsharp mask</a></li>
				<li><a href="#blur">A simple blur filter</a></li>
				<li><a href="#median">A median filter</a></li>
			</ul>
			<h2>Code</h2>
			<p><a href="http://github.com/eightyeight/processee">GitHub</a></p>
		</div>
	</div>
</body>
</html>
